trigger: none

pr: none

variables:
  - group: TERRAFORM_DEV

stages:
  - stage: 'Terraform plan'
    jobs:
      - job: "TerraformInitAndPlan"
        displayName: 'Terraform init and plan'
        pool:
          vmImage: 'ubuntu-latest'

        steps:
          - task: TerraformCLI@0
            displayName: 'Terraform: init'
            inputs:
              command: "init"
              backendType: "azurerm"
              workingDirectory: "terraform"
              backendServiceArm: "VisualStudioEnterprise"
              backendAzureRmResourceGroupName: "$(TF_STATE_RG)"
              backendAzureRmStorageAccountName: "$(TF_STATE_ACCOUNT)"
              backendAzureRmContainerName: "$(TF_STATE_CONTAINER)"
              backendAzureRmKey: "$(TF_STATE_KEY)"

          - task: TerraformCLI@0
            displayName: 'Terraform: fmt -check'
            inputs:
              command: "fmt -check"
              backendType: "azurerm"
              workingDirectory: "terraform"
